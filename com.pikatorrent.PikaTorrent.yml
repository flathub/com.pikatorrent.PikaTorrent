app-id: com.pikatorrent.PikaTorrent
runtime: org.freedesktop.Platform
runtime-version: '24.08'
sdk: org.freedesktop.Sdk
command: pikatorrent
finish-args:
  - --share=ipc
  - --share=network
  - --filesystem=xdg-download
  - --socket=wayland
  - --socket=fallback-x11
cleanup:
modules:
  - name: PikaTorrent
    buildsystem: simple
    build-commands:
      - mv pikatorrent /app/pikatorrent
      - mkdir -p /app/bin
      - ln -s /app/pikatorrent/pikatorrent /app/bin/pikatorrent
    post-install:
      - install -Dm644 com.pikatorrent.PikaTorrent.desktop ${FLATPAK_DEST}/share/applications/com.pikatorrent.PikaTorrent.desktop
      - install -Dm644 com.pikatorrent.PikaTorrent.metainfo.xml ${FLATPAK_DEST}/share/metainfo/com.pikatorrent.PikaTorrent.metainfo.xml
      - install -Dm644 icon.png ${FLATPAK_DEST}/share/icons/hicolor/512x512/apps/${FLATPAK_ID}.png
    sources:
      - type: archive
        url: https://github.com/G-Ray/pikatorrent/releases/download/v0.12.0/PikaTorrent-v0.12.0-linux-x64.zip
        sha256: e9469e9a1bc45e0bbb7f527c6c6da7b71c91042af755e3b7a94ec2b08a6c254d
        dest: pikatorrent
        strip-components: 0
        only-arches:
          - x86_64
        x-checker-data:
          is-main-source: true
          type: json
          url: https://api.github.com/repos/G-Ray/pikatorrent/releases/latest
          version-query: .tag_name | sub("^v"; "")
          timestamp-query: .published_at
          url-query: .assets | map(.browser_download_url | select(endswith("-linux-x64.zip")))
            | first

      - type: archive
        url: https://github.com/G-Ray/pikatorrent/releases/download/v0.12.0/PikaTorrent-v0.12.0-linux-arm64.zip
        sha256: f09e959715f56796105f4dabb05587045d240ddb45eefe49dc4f58316b0d79e4
        dest: pikatorrent
        strip-components: 0
        only-arches:
          - aarch64
        x-checker-data:
          type: json
          url: https://api.github.com/repos/G-Ray/pikatorrent/releases/latest
          version-query: .tag_name | sub("^v"; "")
          timestamp-query: .published_at
          url-query: .assets | map(.browser_download_url | select(endswith("-linux-arm64.zip")))
            | first

      - type: file
        dest-filename: com.pikatorrent.PikaTorrent.metainfo.xml
        url: https://raw.githubusercontent.com/G-Ray/pikatorrent/v0.12.0/app/linux/packaging/com.pikatorrent.PikaTorrent.metainfo.xml
        sha256: 8a46de476944c200e37380d44f73f392d741b99161b12c914b78ce0c1751932c
        x-checker-data:
          type: json
          url: https://api.github.com/repos/G-Ray/pikatorrent/releases/latest
          tag-query: .tag_name
          version-query: .tag_name | sub("^v"; "")
          timestamp-query: .published_at
          url-query: '"https://raw.githubusercontent.com/G-Ray/pikatorrent/" + $tag
            + "/app/linux/packaging/com.pikatorrent.PikaTorrent.metainfo.xml"'

      - type: file
        dest-filename: com.pikatorrent.PikaTorrent.desktop
        url: https://raw.githubusercontent.com/G-Ray/pikatorrent/v0.12.0/app/linux/packaging/com.pikatorrent.PikaTorrent.desktop
        sha256: 4bd452e7a3382009c96ce731b4e3d38ffc570c778808b5979d0d1ecb9a1dfcfa
        x-checker-data:
          type: json
          url: https://api.github.com/repos/G-Ray/pikatorrent/releases/latest
          tag-query: .tag_name
          version-query: .tag_name | sub("^v"; "")
          timestamp-query: .published_at
          url-query: '"https://raw.githubusercontent.com/G-Ray/pikatorrent/" + $tag
            + "/app/linux/packaging/com.pikatorrent.PikaTorrent.desktop"'

      - type: file
        dest-filename: icon.png
        url: https://raw.githubusercontent.com/G-Ray/pikatorrent/v0.12.0/app/linux/packaging/icon.png
        sha256: f59d0e72153051e9babea4889af24c8cf05a46e1cdb7ef26179ba24a62d63604
        x-checker-data:
          type: json
          url: https://api.github.com/repos/G-Ray/pikatorrent/releases/latest
          tag-query: .tag_name
          version-query: .tag_name | sub("^v"; "")
          timestamp-query: .published_at
          url-query: '"https://raw.githubusercontent.com/G-Ray/pikatorrent/" + $tag
            + "/app/linux/packaging/icon.png"'

